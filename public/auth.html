<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram騾｣謳ｺ - 繧｢繧ｫ繧ｦ繝ｳ繝郁ｪ崎ｨｼ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-container {
            background: white;
            border-radius: 16px;
            padding: 48px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            margin-bottom: 16px;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .permissions-list {
            background: #f9fafb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .permissions-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }

        .permission-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .permission-item:last-child {
            margin-bottom: 0;
        }

        .permission-icon {
            width: 24px;
            height: 24px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .permission-text {
            color: #374151;
            font-size: 14px;
            line-height: 1.6;
        }

        .auth-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 16px;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(188, 24, 136, 0.4);
        }

        .auth-button:active {
            transform: translateY(0);
        }

        .auth-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .cancel-button {
            width: 100%;
            padding: 16px;
            background: white;
            color: #666;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-button:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .info-box p {
            color: #1e40af;
            font-size: 14px;
            line-height: 1.6;
        }

        .status-message {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .status-message.success {
            background: #dcfce7;
            color: #16a34a;
            display: block;
        }

        .status-message.error {
            background: #fee2e2;
            color: #dc2626;
            display: block;
        }

        .loading-spinner {
            display: none;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .auth-button.loading .button-text {
            display: none;
        }

        .auth-button.loading .loading-spinner {
            display: block;
        }

        @media (max-width: 600px) {
            .auth-container {
                padding: 32px 24px;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="logo">
            <div class="logo-icon">沒ｸ</div>
            <h1>Instagram騾｣謳ｺ</h1>
            <p class="subtitle">Instagram繧｢繧ｫ繧ｦ繝ｳ繝医ｒDM邂｡逅・す繧ｹ繝・Β縺ｫ騾｣謳ｺ縺励∪縺・/p>
        </div>

        <div id="status-message" class="status-message"></div>

        <div class="info-box">
            <p><strong>縺薙・繧｢繝励Μ縺悟ｿ・ｦ√→縺吶ｋ讓ｩ髯撰ｼ・/strong><br>
            莉･荳九・讓ｩ髯舌ｒ險ｱ蜿ｯ縺吶ｋ縺薙→縺ｧ縲√す繧ｹ繝・Β縺瑚・蜍墓兜遞ｿ縺ｨDM邂｡逅・ｒ螳溯｡後〒縺阪ｋ繧医≧縺ｫ縺ｪ繧翫∪縺吶・/p>
        </div>

        <div class="permissions-list">
            <div class="permissions-title">隕∵ｱゅ＆繧後ｋ讓ｩ髯・/div>
            
            <div class="permission-item">
                <div class="permission-icon">笨・/div>
                <div class="permission-text">
                    <strong>instagram_basic</strong><br>
                    蝓ｺ譛ｬ逧・↑繝励Ο繝輔ぅ繝ｼ繝ｫ諠・ｱ縺ｮ蜿門ｾ・
                </div>
            </div>

            <div class="permission-item">
                <div class="permission-icon">笨・/div>
                <div class="permission-text">
                    <strong>instagram_content_publish</strong><br>
                    逕ｻ蜒上・蜍慕判繝ｻ繝ｪ繝ｼ繝ｫ縺ｮ謚慕ｨｿ讓ｩ髯・
                </div>
            </div>

            <div class="permission-item">
                <div class="permission-icon">笨・/div>
                <div class="permission-text">
                    <strong>pages_show_list</strong><br>
                    邂｡逅・＠縺ｦ縺・ｋ繝壹・繧ｸ荳隕ｧ縺ｮ蜿門ｾ・
                </div>
            </div>

            <div class="permission-item">
                <div class="permission-icon">笨・/div>
                <div class="permission-text">
                    <strong>pages_read_engagement</strong><br>
                    繝壹・繧ｸ縺ｮ繧ｳ繝｡繝ｳ繝医・繝｡繝・そ繝ｼ繧ｸ縺ｮ隱ｭ縺ｿ蜿悶ｊ
                </div>
            </div>

            <div class="permission-item">
                <div class="permission-icon">笨・/div>
                <div class="permission-text">
                    <strong>pages_manage_metadata</strong><br>
                    繝壹・繧ｸ險ｭ螳壹・邂｡逅・→繝｡繧ｿ繝・・繧ｿ縺ｸ縺ｮ繧｢繧ｯ繧ｻ繧ｹ
                </div>
            </div>
        </div>

        <button class="auth-button" id="auth-button" onclick="initiateAuth()">
            <span class="button-text">Instagram繧｢繧ｫ繧ｦ繝ｳ繝医ｒ騾｣謳ｺ</span>
            <div class="loading-spinner"></div>
        </button>

        <button class="cancel-button" onclick="cancelAuth()">繧ｭ繝｣繝ｳ繧ｻ繝ｫ</button>
    </div>

    <script>
        // 迺ｰ蠅・､画焚・亥ｮ滄圀縺ｮ蛟､縺ｫ鄂ｮ縺肴鋤縺医※縺上□縺輔＞・・
        const CONFIG = {
            appId: '1894715221336033', // Facebook App ID
            redirectUri: 'https://krugu1.vercel.app/auth-callback.html',
            state: generateState()
        };

        function generateState() {
            return Math.random().toString(36).substring(2, 15) + 
                   Math.random().toString(36).substring(2, 15);
        }

        function initiateAuth() {
            const button = document.getElementById('auth-button');
            button.classList.add('loading');
            button.disabled = true;

            // state繧痴essionStorage縺ｫ菫晏ｭ假ｼ・SRF蟇ｾ遲厄ｼ・
            sessionStorage.setItem('oauth_state', CONFIG.state);

            // 蠢・ｦ√↑讓ｩ髯舌・繧ｹ繧ｳ繝ｼ繝・
            const scope = [
                'instagram_basic',
                'instagram_content_publish',
                'pages_show_list',
                'pages_read_engagement',
                'pages_manage_metadata'
            ].join(',');

            // Facebook OAuth URL
            const authUrl = `https://www.facebook.com/v21.0/dialog/oauth?` +
                `client_id=${CONFIG.appId}` +
                `&redirect_uri=${encodeURIComponent(CONFIG.redirectUri)}` +
                `&scope=${encodeURIComponent(scope)}` +
                `&response_type=code` +
                `&state=${CONFIG.state}`;

            console.log('沐 Redirecting to Facebook OAuth...');
            console.log('Requested scopes:', scope);

            // OAuth隱崎ｨｼ繝壹・繧ｸ縺ｫ繝ｪ繝繧､繝ｬ繧ｯ繝・
            setTimeout(() => {
                window.location.href = authUrl;
            }, 500);
        }

        function cancelAuth() {
            if (confirm('隱崎ｨｼ繧偵く繝｣繝ｳ繧ｻ繝ｫ縺励∪縺吶°・・)) {
                window.location.href = '/';
            }
        }

        // 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ陦ｨ遉ｺ
        function showMessage(message, type) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type}`;
        }

        // URL繝代Λ繝｡繝ｼ繧ｿ縺九ｉ繧ｨ繝ｩ繝ｼ繧偵メ繧ｧ繝・け
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');
            const errorDescription = urlParams.get('error_description');

            if (error) {
                showMessage(
                    errorDescription || '隱崎ｨｼ縺ｫ螟ｱ謨励＠縺ｾ縺励◆縲ゅｂ縺・ｸ蠎ｦ縺願ｩｦ縺励￥縺縺輔＞縲・,
                    'error'
                );
            }
        });
    </script>
</body>
</html>
